%description:
TODO

%file: package.ned
package @TESTNAME@;
@namespace(nesting);

%file: test.ned
package @TESTNAME@;

import inet.networklayer.configurator.ipv4.Ipv4NetworkConfigurator;
import inet.node.ethernet.EtherSwitch;
import nesting.node.nesting.NestingStandardHost;
import ned.DatarateChannel;


channel cable extends DatarateChannel
{
    parameters:
        delay = 2ns;
        datarate = 1Gbps;
}

network Sim
{
    parameters:
        @display("bgb=382,266");
    submodules:
        s0: EtherSwitch {
            @display("p=181,122");
        }
        h0: NestingStandardHost {
            @display("p=83,123");
        }
        h1: NestingStandardHost {
            @display("p=301,54");
        }
        h2: NestingStandardHost {
            @display("p=301,123");
        }
        h3: NestingStandardHost {
            @display("p=301,197");
        }
        configurator: Ipv4NetworkConfigurator {
            @display("is=s;p=63,39");
        }
    connections:
        h0.ethg++ <--> cable <--> s0.ethg++;
        h1.ethg++ <--> cable <--> s0.ethg++;
        h2.ethg++ <--> cable <--> s0.ethg++;
        h3.ethg++ <--> cable <--> s0.ethg++;
}

%inifile: omnetpp.ini
[General]
outputvectormanager-class="omnetpp::envir::SqliteOutputVectorManager"
outputscalarmanager-class="omnetpp::envir::SqliteOutputScalarManager"

network = Sim

check-signals = true
record-eventlog = false
debug-on-errors = true
result-dir = result_dir
output-vector-file = result_dir/Sim_vec.sqlite
output-scalar-file = result_dir/Sim_sca.sqlite
sim-time-limit = 100ms

**.h0.numApps = 1
**.h0.app[0].typename = "UdpScheduledTrafficApp"
**.h0.app[0].trafficGenerator.localPort = 100
**.h0.app[0].scheduleManager.initialAdminSchedule = xmldoc("datagram_schedule_h0.xml")

**.h{1..3}.numApps = 1
**.h{1..3}.app[0].typename = "UdpSink"
**.h{1..3}.app[0].localPort = 100

%file: datagram_schedule_h0.xml
<datagramSchedule cycleTime="200us">
    <entry payloadSize="500B" destAddress="h1" destPort="100" pcp="7" de="true" vid="2" timeInterval="30us"/>
    <entry payloadSize="600B" destAddress="h2" destPort="100" pcp="7" de="true" vid="2" timeInterval="40us"/>
    <entry payloadSize="700B" destAddress="h3" destPort="100" pcp="7" de="true" vid="2" timeInterval="130us"/>
</datagramSchedule>

%exitcode: 0
